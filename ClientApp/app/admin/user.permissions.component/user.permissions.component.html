<form *ngIf="selectedUser" #thisForm='ngForm'>
    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="row">
                <div class="col-md-6 section-heading">
                    <h4>
                        <strong>
                            <span class="glyphicon glyphicon-user"></span>
                            <span>User Configuration for {{selectedUser.accountName}}</span>
                        </strong>
                    </h4>
                </div>
                <div class="col-md-6">
                    <div class="admin-buttons pull-right">
                        <button class="btn btn-primary" [disabled]="!isDirty(thisForm)" (click)="undoChanges(thisForm)">Undo</button>
                        <button class="btn btn-primary" [disabled]="!isDirty(thisForm)" (click)="saveChanges(thisForm)">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-body">

            <h4>Module Permissions</h4>
            <div class="well">
                <table class="table table-responsive table-striped">
                    <thead>
                        <tr class="row">
                            <th class="col-md-2">Active</th>
                            <th class="col-md-2">Payroll</th>
                            <th class="col-md-2">Assessments</th>
                            <th class="col-md-2">Admin</th>
                            <th class="col-md-2">Accident</th>
                            <th class="col-md-2">Reporting</th>
                            <!-- <th class="col-md-3">Default Team</th>
                            <th class="col-md-1">Can Authorise Payroll Adjustments</th>
                            <th class="col-md-1">Can Reject Payroll Adjustments</th> -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="row">
                            <td><p-checkbox [(ngModel)]="selectedUser.isActive" binary="true" name="isActive"></p-checkbox></td>
                            <td><p-checkbox [(ngModel)]="selectedUser.isPayrollUser" binary="true" name="isPayrollUser"></p-checkbox></td>
                            <td><p-checkbox [(ngModel)]="selectedUser.isAssessmentUser" binary="true" name="isAssessmentUser"></p-checkbox></td>
                            <td><p-checkbox [(ngModel)]="selectedUser.isAdmin" binary="true" name="isAdmin"></p-checkbox></td>
                            <td><p-checkbox [(ngModel)]="selectedUser.isAccidentUser" binary="true" name="isAccidentUser"></p-checkbox></td>
                            <td><p-checkbox [(ngModel)]="selectedUser.isReportingUser" binary="true" name="isReportingUser"></p-checkbox></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div *ngIf="selectedUser.isPayrollUser">
                <h4>Payroll Configuration</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="well">
                            <div class="row">
                                <div class="col-md-6">
                                    <span class="proper-font">Default Team</span>
                                </div>
                                <div class="col-md-6">
                                    <select class="form-control" id="teamSelect" [(ngModel)]="selectedUser.defaultTeamCode" name="defaultTeamCode">
                                        <option *ngFor="let team of authTeams" [ngValue]="team.teamCode">{{team.teamDesc}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <hr/>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <span>Can Authorise Payroll Adjustments</span>
                                        <p-checkbox [(ngModel)]="selectedUser.canAuthoriseAdjustments" binary="true" name="canAuthoriseAdjustments"></p-checkbox>
                                    </label>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <span>Can Reject Payroll Adjustments</span>
                                        <p-checkbox [(ngModel)]="selectedUser.canRejectAdjustments" binary="true" name="canRejectAdjustments"></p-checkbox>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="well">
                            <span class="proper-font">Authorised Teams</span>
                            <table class="table table-striped">
                                <thead>
                                    <tr class="row">
                                        <th class="col-md-6">Team</th>
                                        <th class="col-md-3">Can View</th>
                                        <th class="col-md-3">Can Authorise Exports</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let auth of selectedUser.authorizedTeams; trackBy: codeOfTeam" class="row">
                                        <td>
                                            <select class="form-control" [(ngModel)]="auth.teamCode" (change)="updateAuthTeams()" [name]="'authTeamCode_' + auth.teamCode">
                                                <option *ngFor="let team of authable(auth)" [ngValue]="team.teamCode">{{team.teamDesc}}</option>
                                            </select>
                                        </td>
                                        <td>
                                            <p-checkbox [(ngModel)]="auth.canView" binary="true" [name]="'canView_' + auth.teamCode"></p-checkbox>
                                        </td>
                                        <td>
                                            <p-checkbox [(ngModel)]="auth.canAuthorizeExports" binary="true" [name]="'canAuthorizeExports_' + auth.teamCode"></p-checkbox>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <a class="btn btn-primary" (click)="addTeam()">Add Team</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</form>
